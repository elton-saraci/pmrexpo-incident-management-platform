<div class="report-page">
  <!-- Success toast -->
  <div class="toast toast--success" *ngIf="submitSuccess">
    <span class="toast-icon">‚úÖ</span>
    <span class="toast-text">{{ successMessage }}</span>
  </div>

  <div class="report-card">
    <header class="report-header">
      <h1>Report an Incident</h1>
      <p class="subtitle">
        Help local emergency services by quickly reporting what you see.
        Choose a type, optionally add a description or photo. Your location is used
        automatically in the background.
      </p>
    </header>

    <!-- Error banner (if submission fails) -->
    <div class="banner banner--error" *ngIf="submitError">
      ‚ö†Ô∏è {{ submitError }}
    </div>

    <form
      [formGroup]="form"
      (ngSubmit)="formSubmit()"
      class="report-form"
      novalidate
    >
      <!-- Incident type -->
      <div class="form-group">
        <label for="typeControl" class="field-label">Incident type</label>
        <p class="field-hint">
          Select the category that best matches what you‚Äôre reporting.
        </p>

        <div class="type-grid">
          <button
            type="button"
            class="type-pill"
            [class.active]="form.controls.type.value === 'forest_fire'"
            (click)="form.controls.type.setValue('forest_fire')"
          >
            <span class="icon">üå≤üî•</span>
            <span class="pill-text">
              <span class="pill-title">Forest fire</span>
              <span class="pill-sub">Smoke or fire in vegetation</span>
            </span>
          </button>

          <button
            type="button"
            class="type-pill"
            [class.active]="form.controls.type.value === 'house_fire'"
            (click)="form.controls.type.setValue('house_fire')"
          >
            <span class="icon">üè†üî•</span>
            <span class="pill-text">
              <span class="pill-title">House on fire</span>
              <span class="pill-sub">Residential or building fire</span>
            </span>
          </button>

          <button
            type="button"
            class="type-pill"
            [class.active]="form.controls.type.value === 'blackout'"
            (click)="form.controls.type.setValue('blackout')"
          >
            <span class="icon">üí°‚ö°</span>
            <span class="pill-text">
              <span class="pill-title">Blackout</span>
              <span class="pill-sub">Power outage in the area</span>
            </span>
          </button>

          <button
            type="button"
            class="type-pill"
            [class.active]="form.controls.type.value === 'flood'"
            (click)="form.controls.type.setValue('flood')"
          >
            <span class="icon">üåä</span>
            <span class="pill-text">
              <span class="pill-title">Flood</span>
              <span class="pill-sub">High water or flooded streets</span>
            </span>
          </button>
        </div>

        <div class="field-error" *ngIf="form.controls.type.invalid && form.touched">
          Please select an incident type.
        </div>
      </div>

      <!-- Location -->
      <div class="form-group">

        <div class="location-row">

          <div class="location-status" *ngIf="!isGettingLocation && latitude && longitude">
          </div>

          <div class="location-status" *ngIf="!isGettingLocation && (!latitude || !longitude)">
            <span>Location not available yet</span>
          </div>
        </div>

        <div class="field-error" *ngIf="locationError">
          {{ locationError }}
        </div>
      </div>

      <!-- Description -->
      <div class="form-group">
        <label for="descriptionControl" class="field-label">
          Description <span class="optional">(optional)</span>
        </label>
        <p class="field-hint">
          Briefly describe what you see (e.g. ‚Äúheavy smoke, strong wind, people nearby‚Äù).
        </p>
        <textarea
          id="descriptionControl"
          formControlName="description"
          rows="3"
          placeholder="Add any details that might be useful for responders‚Ä¶"
        ></textarea>
      </div>

      <!-- Photo / Camera section -->
      <div class="form-group">
        <label class="field-label">
          Photo <span class="optional">(optional)</span>
        </label>
        <p class="field-hint">
          A clear photo can help responders assess the situation faster.
        </p>

        <!-- Camera / permission status -->
        <div class="camera-status" *ngIf="isRequestingCamera">
          Requesting camera access‚Ä¶
        </div>
        <div class="camera-status camera-status--ok" *ngIf="cameraReady && !cameraError">
          ‚úÖ Camera access granted. You can take a photo directly.
        </div>
        <div class="camera-status camera-status--error" *ngIf="cameraError">
          {{ cameraError }}
        </div>

        <div class="file-row">
          <input
            id="attachmentControl"
            type="file"
            accept="image/*"
            capture="environment"
            (change)="onFileSelected($event)"
          />
          <label for="attachmentControl" class="upload-btn">
            üì∑ Take or upload a photo
          </label>

          <span class="file-name" *ngIf="selectedFileName">
            {{ selectedFileName }}
          </span>
          <span class="file-name file-name--muted" *ngIf="!selectedFileName">
            No file selected
          </span>
        </div>
      </div>

      <!-- Submit -->
      <footer class="form-footer">
        <button
          type="submit"
          class="primary-btn"
          [disabled]="form.invalid || isSubmitting"
        >
          <span *ngIf="!isSubmitting">Submit incident</span>
          <span *ngIf="isSubmitting">Sending‚Ä¶</span>
        </button>

        <p class="disclaimer">
          Only submit real incidents. Your report may be shared with local emergency services.
        </p>
      </footer>
    </form>
  </div>
</div>
